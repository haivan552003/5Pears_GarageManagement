@page "/news"
@using MudBlazor
@inject HttpClient Http
@inject NavigationManager Navigation

<MudContainer Class="pa-0" style="margin-top:95px; max-width: 1200px; padding: 0 16px;">
    <div class="border-bottom pb-4 mb-6">
        <MudText Typo="Typo.h5" Class="mb-4">TIN TỨC NỔI BẬT</MudText>

        @if (_loading)
        {
            <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
        }
        else if (_news != null)
        {
            <MudGrid>
                <MudItem xs="12" md="6">
                    @if (_news.FirstOrDefault() != null)
                    {
                        <MudCard Elevation="2" Class="featured-card h-100">
                            <MudCardMedia Image="@_news.FirstOrDefault()?.news_img"
                                          Height="340" />
                            <MudCardContent>
                                <MudText Typo="Typo.h6" Class="mb-2">
                                    @(_news.FirstOrDefault()?.title)
                                </MudText>
                                <div class="d-flex align-center mt-2">
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                                        <MudIcon Icon="@Icons.Material.Filled.DateRange" Title="date" />
                                        @(_news.FirstOrDefault()?.date_create.ToString("dd/MM/yyyy"))
                                    </MudText>
                                    <MudDivider Vertical="true" FlexItem="true" Class="mx-2" />
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                                        <MudIcon Icon="@Icons.Material.Outlined.SupervisedUserCircle" Title="Favorite" />
                                        @(_news.FirstOrDefault()?.fullname)
                                    </MudText>
                                </div>
                            </MudCardContent>
                            <MudCardActions Class="justify-end">
                                <MudLink OnClick="@(() => ViewDetails(_news.FirstOrDefault()))"
                                    Underline="Underline.None" Color="Color.Primary">
                                    Xem thêm >>
                                </MudLink>
                            </MudCardActions>
                        </MudCard>
                    }
                </MudItem>
                <MudItem xs="12" md="6" Class="d-none d-md-block">
                    <MudGrid Spacing="3">
                        @foreach (var news in _news.Skip(1).Take(2))
                        {
                            <MudItem xs="12">
                                <MudCard Elevation="2" Class="h-100">
                                    <div class="d-flex">
                                        <MudCardMedia Image="@news.news_img"
                                                      Height="260"
                                                      Class="flex-shrink-0"
                                                      Style="width: 50%;" />
                                        <div class="d-flex flex-column justify-space-between take4">
                                            <MudCardContent>
                                                <MudText Typo="Typo.subtitle2" Class="text-truncate-2">
                                                    @news.title
                                                </MudText>
                                                <div class="d-flex align-center mt-2">
                                                    <MudStack Spacing="2">
                                                        <MudText Typo="Typo.body2" Color="Color.Secondary">
                                                            <MudIcon Icon="@Icons.Material.Filled.DateRange" Title="date" />
                                                            @(_news.FirstOrDefault()?.date_create.ToString("dd/MM/yyyy"))
                                                        </MudText>

                                                        <MudDivider />

                                                        <MudText Typo="Typo.body2" Color="Color.Secondary">
                                                            <MudIcon Icon="@Icons.Material.Outlined.SupervisedUserCircle" Title="Favorite" />
                                                            @(_news.FirstOrDefault()?.fullname)
                                                        </MudText>
                                                    </MudStack>
                                                </div>
                                            </MudCardContent>
                                            <MudCardActions Class="justify-end">
                                                <MudLink OnClick="@(() => ViewDetails(news))" Underline="Underline.None" Color="Color.Primary">
                                                    Xem thêm >>
                                                </MudLink>
                                            </MudCardActions>
                                        </div>
                                    </div>
                                </MudCard>
                            </MudItem>
                        }
                    </MudGrid>
                </MudItem>
            </MudGrid>
        }
    </div>

    @* TẤT CẢ TIN TỨC Section *@
    <div class="mt-6">
        <MudText Typo="Typo.h5" Class="mb-4">TẤT CẢ TIN TỨC</MudText>

        @if (!_loading && _news != null)
        {
            <MudGrid Spacing="4">
                @foreach (var news in _news)
                {
                    <MudItem xs="12" sm="6" md="4" lg="4">
                        <MudCard Elevation="2" Class="h-100">
                            <MudCardMedia Image="@news.news_img"
                                          Height="200" />
                            <MudCardContent>
                                <MudText Typo="Typo.subtitle1" Class="mb-2">
                                    @news.title
                                </MudText>
                                <div class="d-flex align-center">
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                                        <MudIcon Icon="@Icons.Material.Filled.DateRange" Title="date" />
                                        @(_news.FirstOrDefault()?.date_create.ToString("dd/MM/yyyy"))
                                    </MudText>
                                    <MudDivider Vertical="true" FlexItem="true" Class="mx-2" />
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                                        <MudIcon Icon="@Icons.Material.Outlined.SupervisedUserCircle" Title="name" />
                                        @(_news.FirstOrDefault()?.fullname)
                                    </MudText>
                                </div>
                            </MudCardContent>
                            <MudCardActions Class="justify-end">
                                <MudLink OnClick="@(() => ViewDetails(news))" Underline="Underline.None" Color="Color.Primary">
                                    Xem thêm >>
                                </MudLink>
                            </MudCardActions>
                        </MudCard>
                    </MudItem>
                }
            </MudGrid>
        }
    </div>
</MudContainer>

<style>
    .mud-card {
        transition: all 0.2s ease-in-out;
    }

        .mud-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

    .take4 {
        flex-grow: 1;
        border-top-left-radius: inherit;
        border-bottom-left-radius: inherit;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .mud-card-media {
        background-size: cover;
        background-position: center;
    }

    .featured-card .mud-card-media {
        height: 400px !important;
    }

    .border-bottom {
        border-bottom: 1px solid #e0e0e0;
    }

    .text-truncate-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

@code {
    private List<news> _news;
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _news = await Http.GetFromJsonAsync<List<news>>("http://localhost:49922/api/News");
            _loading = false;
        }
        catch (Exception)
        {
            _loading = false;
        }
    }

    private void ViewDetails(news news)
    {
        if (news != null)
        {
            Navigation.NavigateTo($"/news/{news.id}");
        }
    }
}